{% extends 'gorod/layout.html' %}

{% load staticfiles %}
{% load thumbnail %}
{% load humanize %}

{% block meta_title %}{{ city.title }} — события города{% endblock %}

{% block meta_description %}Новости {{ city.title }}, каталог организаций, полезная информация{% endblock %}


{% block content %}
    <div class="b-feed__wrapper">
        <div class="b-feed">
            <ul class="b-feed__list">
                <div class="grid-sizer"></div>
                <div class="gutter-sizer"></div>

                {% for article in articles %}

                    {# photo without picture not working #}
                    <li class="b-feed-item  b-feed-item_{{article.rubric}}" >
                
                        <div class="b-feed-item__top">
                            <a class="b-feed-item__rubric" href="{% url 'gorod:feed-rubric' city.name article.rubric.name %}">
                                {{ article.rubric.title }}
                            </a>
                            <span class="b-feed-item__date">{{ article.add_date|naturalday }}</span>
                        </div>
                        <a class="b-feed-item__link" href="{% url 'gorod:article' city.name article.id %}">
                            {# title photo #}
                            {% if article.rubric.name == "photo" %}
                                <h2 class="b-feed-item__title">{{ article.title }}</h2> 
                            {% endif %}

                            {#  img #}    
                            {% if article.picture %}
                                <img class="b-feed-item__picture" src="{{ article.picture|thumbnail_url:'feed_image' }}" />
                            {% endif %} 

                            {# title not photo #}
                            {% if article.rubric.name != "photo" %}
                                <h2 class="b-feed-item__title">{{ article.title }}</h2> 
                            {% endif %} 

                            {# not photo text #} 
                            {% if article.text and article.rubric.name != "photo"%}  
                                <p class="b-feed-item__text">
                                    {% autoescape off %}
                                    {{ article.text|striptags|truncatechars:255 }} 
                                    {% endautoescape %}
                                </p>
                            {% endif %} 
                        </a>
                    </li>
                {% endfor %}
            </ul>
            
        </div>
    </div>

{% endblock %}

