{% extends 'gorod/layout.html' %}

{% load staticfiles %}
{% load humanize %}
{% load user %}

{% block meta_title %}{{ article.title }} - {{city.title}}{% endblock %}

{% block meta_description %}{{ article.title }} - {{city.title}}{% endblock %}

{% block static_additional %}
    <script src="{% static 'comments/js/comments.js' %}"></script>
    <script>
        // open comments
        $(function(){
            if ($(location).attr('hash') != "#comments-cnt") {
                $(".b-comments-cnt__link").on("click", function() {
                    $(".b-article__comments").show();
                });
            }
            else {
                // Scroll to comment previous to last
                $(".b-article__comments").show();
                $(location).attr('hash', "#" + $(".b-comment:last").prev().find("a").attr("name"));
            }

            var comments = new Comments();
        });
    </script>
    <style>
        .b-article__comments {
            margin-top: 50px;
            display: none;
        }

        .b-comments-cnt {
            float: right;
            padding: 28px 10px 0 0;
        }

        .b-comment {
            margin-bottom: 30px;
        }

        .b-comment__user {
            float: left;
        }

        .b-comment__date {
            float: right;
        }

        .b-comment__text {
            margin-top: 10px;
        }

        #id_honeypot {
            display: none;
        }

        .b-comments__add .error{
            color: red;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="b-article__wrapper">
        <div class="b-article b-article_{{article.rubric.name}}">
            
            <div class="b-article__content">

                <div class="b-article__info">
                    <div class="b-article__descr">
                        <a href="{% url 'gorod:feed-rubric' city.name article.rubric.name %}" class="b-article__rubric">{{ article.rubric.title }}</a>

                        <span class="b-article__date">{{ article.add_date|naturalday }}</span>
                    </div>
                    
                    {% if user == article.user or user.is_superuser %}
                        <span class="edit-link edit-link_article">Редактировать</span>
                    {% else %}
                        <div class="b-article__author">
                            {% user article.user %}
                        </div> 
                    {% endif %} 
                    <div class="clear"></div>
                </div>
                
                <h2 class="b-article__title">{{ article.title }}</h2>

                <div class="b-article__text">
                    {% autoescape off %}
                        {{ article.text }} 
                    {% endautoescape %} 
                </div>

                {% if article.picture and article.picture.url %}
                    <img class="b-article__picture" src="{{article.picture.url}}" />
                {% endif %}

                <div class="clear"></div>
                <div class="b-article__service">
                    <div class="b-article__share">
                        <span class="b-article__share-text">Поделиться:</span>
                        <script type="text/javascript" src="//yandex.st/share/share.js" charset="utf-8"></script>
                        <div class="yashare-auto-init" data-yashareL10n="ru" data-yashareQuickServices="vkontakte,facebook,twitter,odnoklassniki,moimir" data-yashareTheme="counter"></div> 
                    </div>
                    <div class="b-article__complaint">
                        <a href="mailto:hola@gorod.io"><i></i>Пожаловаться</a>
                    </div>

                    {% with article as object %}
                    {% include "comments/incl/_comments_cnt.html" %}

                    <div class="clear"></div>
                    <div class="b-article__comments">
                        {% include "comments/incl/_comments.html" %}
                    </div>
                    {% endwith %}

                    <div class="clear"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="b-feed__wrapper">
        {% include "gorod/feed/_feed_item.html" %}
        <script>
            $(function(){
                window.ajaxFeed();
            });
        </script>
        <div class="b-feed">
            <span class="b-feed__title">Читать также</span>
            <ul class="b-feed__list">
                <div class="grid-sizer"></div>
                <div class="gutter-sizer"></div>
            </ul>
            <div class="b-feed__more_wrapper"><span class="b-feed__more">Показать еще</span></div>
           
        </div>
    </div>
{% endblock %}

